<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Pokémon Encyclopedia</title>
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Card Flip Styles --- */
        .flip-card-container {
            perspective: 1000px; /* Gives the 3D effect */
            width: 200px; /* Base width for single card */
            height: auto; /* Adjust height as needed to fit content */
            margin: 10px;
            position: relative;
        }
        /* Adjust for paired cards to fit side by side */
        .regional-pair-wrapper .flip-card-container {
            width: 170px; /* Slightly smaller width when part of a pair */
            height: 320px; /* Adjust height accordingly */
            margin: 5px; /* Smaller margin within the pair */
        }


        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s; /* Smooth flip animation */
            transform-style: preserve-3d; /* Keep children in 3D space */
        }

        /* Flip on hover */
        .flip-card-container:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .pokemon-card-front, .pokemon-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Hide the back of the element when it's not facing the user */
            backface-visibility: hidden; /* Standard property */
            border-radius: 0.25rem; /* Match Bootstrap card border-radius */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex; /* Use flex for content alignment */
            flex-direction: column;
            justify-content: space-between; /* Space out content */
            align-items: center; /* Center content horizontally */
            padding: 10px; /* Padding for content */
            overflow: hidden; /* Hide overflow by default */
        }

        .pokemon-card-front {
            background-color: #f8f9fa; /* Light background for front */
            color: #212529; /* Dark text for front */
        }
        body.dark-mode .pokemon-card-front {
            background-color: #343a40;
            color: #e2e6ea;
        }

        .pokemon-card-back {
            background-color: #e9ecef; /* Slightly darker background for back */
            color: #212529; /* Dark text for back */
            transform: rotateY(180deg); /* Start rotated for the back side */
            overflow-y: auto; /* For potentially long details */
            padding-bottom: 10px; /* Padding for back content */
            text-align: left; /* Align text on back to left */
            justify-content: flex-start; /* Align content to top */
            align-items: stretch; /* Stretch content horizontally */
        }
        body.dark-mode .pokemon-card-back {
            background-color: #495057;
            color: #e2e6ea;
        }

        /* Adjustments for images and text on the front card */
        .pokemon-card-front img {
            width: 100%;
            height: 150px;
            object-fit: contain;
            padding: 10px;
        }
        .pokemon-card-front .card-body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            flex-grow: 1;
            width: 100%;
        }
        .pokemon-card-front .card-title {
            margin-top: auto;
            margin-bottom: 5px;
        }

        /* Specific styling for the back content to make it readable */
        .pokemon-card-back h5 {
            text-align: center;
            margin-bottom: 10px;
        }
        .pokemon-card-back h6 {
            margin-top: 10px;
            margin-bottom: 5px;
            text-align: center;
        }
        .pokemon-card-back p {
            margin-bottom: 5px;
            font-size: 0.95em;
            word-wrap: break-word;
        }
        .pokemon-card-back hr {
            margin: 10px 0;
            width: 100%;
        }
        .pokemon-card-back ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 5px;
            width: 100%;
        }
        .pokemon-card-back ul li {
            margin-bottom: 2px;
            word-wrap: break-word;
        }
        .pokemon-card-back .back-content-wrapper {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding-bottom: 10px; /* Add some padding before the bottom of the card */
        }
        .pokemon-card-back .detail-img-small {
            max-width: 80px;
            height: auto;
            display: inline-block;
            vertical-align: middle;
        }

        /* Type badges for better visual distinction */
        .badge {
            font-size: 0.85em;
            padding: 0.4em 0.7em;
            margin: 2px;
        }

        /* Custom styles for different Pokémon types */
        .badge.bg-normal { background-color: #A8A77A !important; }
        .badge.bg-fire { background-color: #EE8130 !important; }
        .badge.bg-water { background-color: #6390F0 !important; }
        .badge.bg-grass { background-color: #7AC74C !important; }
        .badge.bg-electric { background-color: #F7D02C !important; }
        .badge.bg-ice { background-color: #96D9D6 !important; }
        .badge.bg-fighting { background-color: #C22E28 !important; }
        .badge.bg-poison { background-color: #A33EA1 !important; }
        .badge.bg-ground { background-color: #E2BF65 !important; }
        .badge.bg-flying { background-color: #A98FF3 !important; }
        .badge.bg-psychic { background-color: #F95587 !important; }
        .badge.bg-bug { background-color: #A6B91A !important; }
        .badge.bg-rock { background-color: #B6A136 !important; }
        .badge.bg-ghost { background-color: #735797 !important; }
        .badge.bg-dragon { background-color: #6F35FC !important; }
        .badge.bg-steel { background-color: #B7B7CE !important; }
        .badge.bg-fairy { background-color: #D685AD !important; }
        .badge.bg-dark { background-color: #705746 !important; }
        .badge.bg-unknown { background-color: #68A090 !important; }
        .badge.bg-shadow { background-color: #4C2D6A !important; }

        /* Styles for active dropdown toggles */
        .nav-link.dropdown-toggle.active {
            color: #fff !important;
            background-color: rgba(255,255,255,0.1);
            border-radius: 0.25rem;
        }
        /* Style for active dropdown items */
        .dropdown-item.active-filter {
            background-color: #0d6efd; /* Bootstrap primary blue */
            color: #fff;
        }

        /* --- Dark Mode Styles --- */
        body.dark-mode {
            background-color: #212529;
            color: #e2e6ea;
        }

        body.dark-mode .navbar {
            background-color: #343a40 !important;
        }

        body.dark-mode .container {
            background-color: #212529;
        }

        body.dark-mode .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
            filter: brightness(0.9);
        }

        body.dark-mode .btn-outline-success {
            color: #198754;
            border-color: #198754;
        }
        body.dark-mode .btn-outline-secondary {
            color: #6c757d;
            border-color: #6c757d;
        }
        body.dark-mode .btn-info { /* Feeling Lucky button */
            background-color: #0dcaf0;
            border-color: #0dcaf0;
            filter: brightness(0.9);
        }


        body.dark-mode .form-control {
            background-color: #495057;
            color: #e2e6ea;
            border-color: #6c757d;
        }
        body.dark-mode .form-control::placeholder {
            color: #adb5bd;
        }

        body.dark-mode .dropdown-menu-dark {
            background-color: #343a40;
        }
        body.dark-mode .dropdown-menu-dark .dropdown-item {
            color: #e2e6ea;
        }
        body.dark-mode .dropdown-menu-dark .dropdown-item:hover {
            background-color: rgba(255,255,255,0.1);
            color: #ffffff;
        }
        body.dark-mode .dropdown-menu-dark .dropdown-item.active-filter {
            background-color: #0d6efd;
            color: #fff;
        }
        body.dark-mode .alert-danger {
            background-color: #58151c;
            color: #f8d7da;
            border-color: #721c24;
        }

        /* --- Highlight CSS --- */
        .flip-card-container.highlight {
            box-shadow: 0 0 15px 5px rgba(0, 123, 255, 0.7); /* Bootstrap primary blue glow */
            border: 2px solid #007bff; /* A matching border */
            transform: translateY(-5px); /* Lift it slightly to draw more attention */
            transition: box-shadow 0.3s ease-in-out, border 0.3s ease-in-out, transform 0.3s ease-in-out; /* Smooth transition for highlight */
        }

        /* Dark mode specific highlight */
        body.dark-mode .flip-card-container.highlight {
            box-shadow: 0 0 15px 5px rgba(25, 135, 84, 0.7); /* Bootstrap success green glow */
            border: 2px solid #198754;
        }

        /* --- NEW: Regional Pair Wrapper Styles --- */
        .regional-pair-wrapper {
            display: flex; /* Use flexbox to arrange inner cards side-by-side */
            flex-wrap: nowrap; /* Prevent wrapping onto new line */
            justify-content: center; /* Center the pair within its column */
            align-items: flex-start; /* Align the tops of the cards */
            gap: 10px; /* Space between the two cards in the pair */
            margin-bottom: 1rem; /* Standard Bootstrap margin-bottom */
            padding: 5px; /* Small padding around the pair */
            /* The .col-* classes will be applied to this wrapper in JS */
            /* Optional: Add a border or background to visually group the pair */
            /* border: 1px dashed #6c757d; */
            /* border-radius: 0.25rem; */
        }
        body.dark-mode .regional-pair-wrapper {
            /* border-color: #495057; */
        }
        /* Ensure responsive grid columns work for the pair wrapper */
        @media (min-width: 1200px) { /* XL devices and up (Original .col-xl-2 grid has 6 per row) */
            .regional-pair-wrapper { width: calc(100% / 3 - 20px); } /* Takes 2x a normal col-2 slot (e.g. 3 pairs per row) */
        }
        @media (min-width: 992px) and (max-width: 1199px) { /* LG devices (Original .col-lg-3 grid has 4 per row) */
            .regional-pair-wrapper { width: calc(100% / 2 - 20px); } /* Takes 2x a normal col-3 slot (e.g. 2 pairs per row) */
        }
        @media (min-width: 768px) and (max-width: 991px) { /* MD devices (Original .col-md-4 grid has 3 per row) */
            .regional-pair-wrapper { width: calc(100% / 1 - 20px); } /* Takes 2x a normal col-4 slot (e.g. 1 pair per row) */
        }
        @media (min-width: 576px) and (max-width: 767px) { /* SM devices (Original .col-sm-6 grid has 2 per row) */
            .regional-pair-wrapper { width: calc(100% / 1 - 20px); } /* Takes 2x a normal col-6 slot (e.g. 1 pair per row) */
        }
        @media (max-width: 575px) { /* XS devices (Original .col-12 grid has 1 per row) */
            .regional-pair-wrapper { flex-direction: column; align-items: center; } /* Stack vertically on small screens */
            .regional-pair-wrapper .flip-card-container { width: 200px; margin: 10px 0; } /* Revert to normal card size */
        }


    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="main-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Pokémon Encyclopedia</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#" id="home-filter" data-filter-type="all">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownGen" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Generation
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdownGen" id="generation-filter-menu">
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="all">All Generations</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="1">Generation I</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="2">Generation II</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="3">Generation III</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="4">Generation IV</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="5">Generation V</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="6">Generation VI</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="7">Generation VII</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="8">Generation VIII</a></li>
                            <li><a class="dropdown-item generation-filter-link" href="#" data-gen-id="9">Generation IX</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownType" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Type
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdownType" id="type-filter-menu">
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="all">All Types</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="normal">Normal</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="fire">Fire</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="water">Water</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="grass">Grass</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="electric">Electric</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="ice">Ice</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="fighting">Fighting</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="poison">Poison</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="ground">Ground</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="flying">Flying</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="psychic">Psychic</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="bug">Bug</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="rock">Rock</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="ghost">Ghost</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="dragon">Dragon</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="steel">Steel</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="fairy">Fairy</a></li>
                            <li><a class="dropdown-item type-filter-link" href="#" data-type="dark">Dark</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownSecondaryType" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Secondary Type
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdownSecondaryType" id="secondary-type-filter-menu">
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="all">Any Secondary Type</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="normal">Normal</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="fire">Fire</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="water">Water</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="grass">Grass</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="electric">Electric</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="ice">Ice</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="fighting">Fighting</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="poison">Poison</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="ground">Ground</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="flying">Flying</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="psychic">Psychic</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="bug">Bug</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="rock">Rock</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="ghost">Ghost</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="dragon">Dragon</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="steel">Steel</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="fairy">Fairy</a></li>
                            <li><a class="dropdown-item secondary-type-filter-link" href="#" data-secondary-type="dark">Dark</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownForms" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Forms
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdownForms" id="forms-filter-menu">
                            <li><a class="dropdown-item forms-filter-link" href="#" data-form-type="all">All Forms</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item forms-filter-link" href="#" data-form-type="mega">Mega Evolutions</a></li>
                            <li><a class="dropdown-item forms-filter-link" href="#" data-form-type="gmax">Gigantamax Forms</a></li>
                            <li><a class="dropdown-item forms-filter-link" href="#" data-form-type="regional">Regional Forms</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownSort" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Sort By: ID (Asc)
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdownSort" id="sort-filter-menu">
                            <li><a class="dropdown-item sort-link active-filter" href="#" data-sort-by="id" data-sort-order="asc">ID (Asc)</a></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="id" data-sort-order="desc">ID (Desc)</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="name" data-sort-order="asc">Name (A-Z)</a></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="name" data-sort-order="desc">Name (Z-A)</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="height" data-sort-order="asc">Height (Shortest)</a></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="height" data-sort-order="desc">Height (Tallest)</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="weight" data-sort-order="asc">Weight (Lightest)</a></li>
                            <li><a class="dropdown-item sort-link" href="#" data-sort-by="weight" data-sort-order="desc">Weight (Heaviest)</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutAndFeaturesModal">About & Features</a>
                    </li>
                </ul>
                <form class="d-flex me-3" id="search-form">
                    <input class="form-control me-2" type="search" placeholder="Search Pokémon" aria-label="Search" id="pokemon-search-input">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                    <button class="btn btn-outline-secondary ms-2" type="button" id="clear-filters-btn">Clear Filters</button>
                    <button class="btn btn-info ms-2" type="button" id="random-pokemon-btn">Feeling Lucky?</button>
                </form>
                <div class="form-check form-switch text-light">
                    <input class="form-check-input" type="checkbox" id="darkModeToggle">
                    <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center" id="pokemon-grid">
            <div id="loading-spinner" class="text-center my-5 d-none">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading Pokémon...</p>
            </div>
            <div id="error-message" class="alert alert-danger d-none" role="alert">
                Failed to load Pokémon. Please try again later.
            </div>
        </div>
    </div>

    <div class="modal fade" id="aboutAndFeaturesModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">About This Pokémon Encyclopedia & Features Guide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4>About This Encyclopedia</h4>
                    <p>Welcome to the ultimate resource for Pokémon enthusiasts! Tired of scattered information and endless searching to find your favorite Pokémon's stats, types, or abilities?</p>
                    <p>Our **Pokémon Encyclopedia** is designed to be your one-stop digital Pokédex. We bring together comprehensive data from all generations into a clean, easy-to-navigate interface.</p>
                    <p>Built with ❤️ by **Arya Shubh**. Explore more projects on my GitHub: <a href="https://github.com/aryashubh001" target="_blank" rel="noopener noreferrer">https://github.com/aryashubh001</a></p>
                    <hr>
                    <h4>How to Use This Encyclopedia's Features</h4>
                    <h6>Discover powerful ways to explore Pokémon:</h6>
                    <ol>
                        <li><strong>Search Bar:</strong> Type any Pokémon's name (or part of it) in the top right to quickly find matches.</li>
                        <li><strong>Generation Filter:</strong> Use the 'Generation' dropdown in the navigation to see Pokémon only from specific game eras.</li>
                        <li><strong>Type Filter:</strong> Filter by Pokémon elemental types (e.g., Fire, Water, Grass) using the 'Type' dropdown.</li>
                        <li><strong>Secondary Type Filter:</strong> Precisely narrow down dual-type Pokémon by their second type using the 'Secondary Type' dropdown.</li>
                        <li><strong>Forms Filter:</strong> Find specific forms like 'Mega Evolutions', 'Gigantamax Forms', or 'Regional Forms' (which will appear side-by-side with their original counterparts!).</li>
                        <li><strong>Sorting Options:</strong> Found under the 'Sort By' dropdown, organize your list by Pokedex ID, Name (alphabetically), Height, or Weight.</li>
                        <li><strong>Card Flip Details:</strong> Simply **hover over** any Pokémon card to flip it and reveal its full stats, abilities, and a description, including their **Base Stat Total**! Move your mouse away to flip it back.</li>
                        <li><strong>Dark Mode:</strong> Toggle the switch in the top right for a more comfortable viewing experience at night.</li>
                        <li><strong>Feeling Lucky?:</strong> Click this button to instantly scroll to a random Pokémon's card, which will be temporarily highlighted!</li>
                    </ol>
                    <p class="text-muted">Your filter and theme preferences are saved for your next visit!</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>
    <script>
        const pokemonGrid = document.getElementById('pokemon-grid');
        const searchInput = document.getElementById('pokemon-search-input');
        const searchForm = document.getElementById('search-form');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const randomPokemonBtn = document.getElementById('random-pokemon-btn');

        const homeFilterLink = document.getElementById('home-filter');
        const generationFilterLinks = document.querySelectorAll('.generation-filter-link');
        const typeFilterLinks = document.querySelectorAll('.type-filter-link');
        const secondaryTypeFilterLinks = document.querySelectorAll('.secondary-type-filter-link');
        const formsFilterLinks = document.querySelectorAll('.forms-filter-link');
        const sortFilterLinks = document.querySelectorAll('.sort-link');

        const darkModeToggle = document.getElementById('darkModeToggle');
        const body = document.body;

        const POKEAPI_BASE_URL = 'https://pokeapi.co/api/v2/pokemon';
        const SPRITE_BASE_URL = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon';

        let allPokemonsData = [];
        let currentGenerationFilter = 'all';
        let currentTypeFilter = 'all';
        let currentSecondaryTypeFilter = 'all';
        let currentFormFilter = 'all';
        let currentSearchTerm = '';
        let currentSortBy = 'id';
        let currentSortOrder = 'asc';

        // Helper function to determine if a Pokémon is a regional form (Alolan, Galarian, Hisuian, Paldean)
        function isRegionalForm(pokemonName) {
            const nameLower = pokemonName.toLowerCase();
            return nameLower.includes('-alola') || nameLower.includes('-galar') || nameLower.includes('-hisuian') || nameLower.includes('-paldea');
        }

        const generationRanges = {
            '1': { start: 1, end: 151 },
            '2': { start: 152, end: 251 },
            '3': { start: 252, end: 386 },
            '4': { start: 387, end: 493 },
            '5': { start: 494, end: 649 },
            '6': { start: 650, end: 721 },
            '7': { start: 722, end: 809 },
            '8': { start: 810, end: 905 },
            '9': { start: 906, end: 1025 },
        };

        function enableDarkMode() {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
            darkModeToggle.checked = true;
        }

        function disableDarkMode() {
            body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
            darkModeToggle.checked = false;
        }

        function loadPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                enableDarkMode();
            } else {
                disableDarkMode();
            }

            const savedGenFilter = localStorage.getItem('generationFilter');
            if (savedGenFilter && (generationRanges[savedGenFilter] || savedGenFilter === 'all')) {
                currentGenerationFilter = savedGenFilter;
                const genLink = document.querySelector(`#generation-filter-menu [data-gen-id="${savedGenFilter}"]`);
                if (genLink) {
                    document.getElementById('navbarDropdownGen').textContent = genLink.textContent;
                    updateActiveNavLink(genLink);
                }
            } else {
                const allGenLink = document.querySelector(`#generation-filter-menu [data-gen-id="all"]`);
                if (allGenLink) updateActiveNavLink(allGenLink);
            }

            const savedTypeFilter = localStorage.getItem('typeFilter');
            if (savedTypeFilter) {
                currentTypeFilter = savedTypeFilter;
                const typeLink = document.querySelector(`#type-filter-menu [data-type="${savedTypeFilter}"]`);
                if (typeLink) {
                    document.getElementById('navbarDropdownType').textContent = typeLink.textContent;
                    updateActiveNavLink(typeLink);
                }
            } else {
                const allTypeLink = document.querySelector(`#type-filter-menu [data-type="all"]`);
                if (allTypeLink) updateActiveNavLink(allTypeLink);
            }

            // Load Secondary Type Filter Preference
            const savedSecondaryTypeFilter = localStorage.getItem('secondaryTypeFilter');
            if (savedSecondaryTypeFilter) {
                currentSecondaryTypeFilter = savedSecondaryTypeFilter;
                const secondaryTypeLink = document.querySelector(`#secondary-type-filter-menu [data-secondary-type="${savedSecondaryTypeFilter}"]`);
                if (secondaryTypeLink) {
                    document.getElementById('navbarDropdownSecondaryType').textContent = `Secondary Type: ${secondaryTypeLink.textContent}`;
                    updateActiveNavLink(secondaryTypeLink);
                }
            } else {
                const allSecondaryTypeLink = document.querySelector(`#secondary-type-filter-menu [data-secondary-type="all"]`);
                if (allSecondaryTypeLink) updateActiveNavLink(allSecondaryTypeLink);
            }

            // Load Form Filter Preference
            const savedFormFilter = localStorage.getItem('formFilter');
            if (savedFormFilter && ['all', 'mega', 'gmax', 'regional'].includes(savedFormFilter)) {
                currentFormFilter = savedFormFilter;
                const formLink = document.querySelector(`#forms-filter-menu [data-form-type="${savedFormFilter}"]`);
                if (formLink) {
                    document.getElementById('navbarDropdownForms').textContent = `Forms: ${formLink.textContent}`;
                    updateActiveNavLink(formLink);
                }
            } else {
                const allFormLink = document.querySelector(`#forms-filter-menu [data-form-type="all"]`);
                if (allFormLink) updateActiveNavLink(allFormLink);
            }

            const initialSortLink = document.querySelector(`#sort-filter-menu [data-sort-by="id"][data-sort-order="asc"]`);
            if (initialSortLink) {
                updateActiveNavLink(initialSortLink);
                document.getElementById('navbarDropdownSort').textContent = `Sort By: ${initialSortLink.textContent}`;
            }
        }

        darkModeToggle.addEventListener('change', () => {
            if (darkModeToggle.checked) {
                enableDarkMode();
            } else {
                disableDarkMode();
            }
        });

        document.addEventListener('DOMContentLoaded', loadPreferences);

        function showLoading(show) {
            if (show) {
                loadingSpinner.classList.remove('d-none');
                errorMessage.classList.add('d-none');
                pokemonGrid.innerHTML = '';
            } else {
                loadingSpinner.classList.add('d-none');
            }
        }

        function showError(show) {
            if (show) {
                errorMessage.classList.remove('d-none');
                loadingSpinner.classList.add('d-none');
            } else {
                errorMessage.classList.add('d-none');
            }
        }

        function getPokemonImageUrl(pokemon) {
            // Prefer front_default from sprites, fallback to ID-based URL
            if (pokemon && pokemon.sprites && pokemon.sprites.front_default) {
                return pokemon.sprites.front_default;
            }
            return `${SPRITE_BASE_URL}/${pokemon.id}.png`;
        }

        async function fetchAllPokemonDetails() {
            showLoading(true);
            try {
                const listResponse = await axios.get(`${POKEAPI_BASE_URL}?limit=10000`);
                const pokemonsOverview = listResponse.data.results;

                const detailPromises = pokemonsOverview.map(pokemon => axios.get(pokemon.url));
                const detailResponses = await Promise.all(detailPromises);

                allPokemonsData = detailResponses.map(response => response.data);

                // --- NEW: Pre-process regional forms to find their original counterparts ---
                const regionalFormProcessingPromises = allPokemonsData.map(async pokemon => {
                    if (isRegionalForm(pokemon.name)) {
                        try {
                            const speciesResponse = await axios.get(pokemon.species.url);
                            const defaultVariety = speciesResponse.data.varieties.find(variety => variety.is_default);
                            if (defaultVariety) {
                                const originalPokemonName = defaultVariety.pokemon.name;
                                let originalData = allPokemonsData.find(p => p.name === originalPokemonName);

                                if (!originalData) {
                                    // Fallback fetch if original wasn't in initial 10000 list (rare, but possible)
                                    const response = await axios.get(defaultVariety.pokemon.url);
                                    originalData = response.data;
                                    // Potentially add to allPokemonsData or a separate cache for future use if needed
                                }
                                pokemon.originalCounterpartData = originalData; // Attach original data to the regional form object
                            }
                        } catch (speciesError) {
                            console.warn(`Could not process species for regional form ${pokemon.name}:`, speciesError);
                        }
                    }
                });
                await Promise.all(regionalFormProcessingPromises); // Wait for all regional form processing to complete

                applyFiltersAndRender();
                showLoading(false);

            } catch (error) {
                console.error("Error fetching Pokémon data:", error);
                showLoading(false);
                showError(true);
            }
        }

        fetchAllPokemonDetails();

        // Helper function to create the basic card structure (extracted from renderPokemons)
        // This function now returns the full .flip-card-container element
        function createPokemonCardElement(pokemon) {
            const cardContainer = document.createElement('div');
            cardContainer.classList.add('flip-card-container'); // 'col' classes are added externally
            cardContainer.dataset.pokemonId = pokemon.id;

            cardContainer.innerHTML = `
                <div class="flip-card-inner">
                    <div class="pokemon-card-front card">
                        <img src="${getPokemonImageUrl(pokemon)}" alt="${pokemon.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/150?text=No+Image';" loading="lazy">
                        <div class="card-body">
                            <h5 class="card-title">${pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1)}</h5>
                        </div>
                    </div>
                    <div class="pokemon-card-back card">
                        <div class="back-content-placeholder text-center w-100 h-100 d-flex flex-column justify-content-center align-items-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading details...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const backContentPlaceholder = cardContainer.querySelector('.back-content-placeholder');
            cardContainer.addEventListener('mouseover', async () => {
                if (!backContentPlaceholder.dataset.loaded) {
                    await populateCardBackDetails(pokemon.id, backContentPlaceholder);
                    backContentPlaceholder.dataset.loaded = 'true';
                }
            });

            return cardContainer;
        }


        function renderPokemons(pokemonsToDisplay) {
            pokemonGrid.innerHTML = '';
            if (pokemonsToDisplay.length === 0) {
                pokemonGrid.innerHTML = '<p class="text-center text-muted col-12">No Pokémon found matching your criteria.</p>';
                return;
            }

            // To avoid rendering the same original counterpart twice if it also appears independently
            const renderedPairOriginalIds = new Set();

            pokemonsToDisplay.forEach(pokemon => {
                // Check if this Pokémon is a regional form, if the 'Forms' filter is set to 'Regional',
                // AND if we have its original counterpart data
                if (currentFormFilter === 'regional' && isRegionalForm(pokemon.name) && pokemon.originalCounterpartData) {
                    
                    // Create cards for both regional and original forms
                    const regionalCard = createPokemonCardElement(pokemon);
                    const originalCard = createPokemonCardElement(pokemon.originalCounterpartData);

                    // Add unique classes for styling if needed
                    regionalCard.classList.add('regional-form-card');
                    originalCard.classList.add('original-counterpart-card');

                    // Create a wrapper for the pair
                    const pairWrapper = document.createElement('div');
                    // Add Bootstrap column classes to the wrapper, which determines how it fits in the grid
                    pairWrapper.classList.add('col-xl-4', 'col-lg-6', 'col-md-6', 'col-sm-12', 'col-12', 'regional-pair-wrapper');
                    
                    // Append individual cards to the wrapper
                    pairWrapper.appendChild(regionalCard);
                    pairWrapper.appendChild(originalCard);

                    pokemonGrid.appendChild(pairWrapper);
                    
                    // Add the original's ID to the set to prevent it from being rendered as a single card later
                    renderedPairOriginalIds.add(pokemon.originalCounterpartData.id);

                } else if (!renderedPairOriginalIds.has(pokemon.id)) {
                    // Render as a single card if:
                    // - It's not a regional form being specifically filtered by 'regional', OR
                    // - It's a base form that hasn't already been rendered as an original counterpart in a pair.
                    const singleCard = createPokemonCardElement(pokemon);
                    // Add standard Bootstrap column classes for single cards
                    singleCard.classList.add('col-xl-2', 'col-lg-3', 'col-md-4', 'col-sm-6', 'col-12', 'mb-3');
                    pokemonGrid.appendChild(singleCard);
                }
            });
        }


        function applyFiltersAndRender() {
            let filtered = allPokemonsData;

            // 1. Apply Generation Filter
            if (currentGenerationFilter !== 'all') {
                const range = generationRanges[currentGenerationFilter];
                if (range) {
                    filtered = filtered.filter(pokemon =>
                        pokemon.id >= range.start && pokemon.id <= range.end
                    );
                }
            }

            // 2. Apply Type Filters (Primary and Secondary)
            if (currentTypeFilter !== 'all' || currentSecondaryTypeFilter !== 'all') {
                filtered = filtered.filter(pokemon => {
                    const types = pokemon.types.map(typeInfo => typeInfo.type.name);

                    if (currentTypeFilter === 'all' && currentSecondaryTypeFilter !== 'all') {
                        // Only secondary type is selected, find Pokémon where the *second* type matches
                        return types.length > 1 && types[1] === currentSecondaryTypeFilter;
                    } else if (currentTypeFilter !== 'all' && currentSecondaryTypeFilter === 'all') {
                        // Only primary type is selected, find Pokémon where the *first* type matches
                        return types.length > 0 && types[0] === currentTypeFilter;
                    } else if (currentTypeFilter !== 'all' && currentSecondaryTypeFilter !== 'all') {
                        // Both primary and secondary types selected, both must match their respective slots
                        return types.length === 2 && types[0] === currentTypeFilter && types[1] === currentSecondaryTypeFilter;
                    }
                    return true;
                });
            }

            // 3. Apply Forms Filter
            if (currentFormFilter !== 'all') {
                // If regional filter, we filter down to just the regional forms here.
                // The `renderPokemons` function will handle showing the original next to it.
                if (currentFormFilter === 'regional') {
                    filtered = filtered.filter(pokemon => isRegionalForm(pokemon.name));
                } else {
                    // For Mega and Gmax, filter as before
                    filtered = filtered.filter(pokemon => {
                        const nameLower = pokemon.name.toLowerCase();
                        switch (currentFormFilter) {
                            case 'mega':
                                return nameLower.includes('-mega');
                            case 'gmax':
                                return nameLower.includes('-gmax');
                            default:
                                return true; // Should not be reached
                        }
                    });
                }
            }

            // 4. Apply Search Term Filter
            if (currentSearchTerm) {
                filtered = filtered.filter(pokemon =>
                    pokemon.name.toLowerCase().includes(currentSearchTerm)
                );
            }

            // 5. Apply Sorting
            filtered.sort((a, b) => {
                let valA, valB;
                switch (currentSortBy) {
                    case 'name':
                        valA = a.name.toLowerCase();
                        valB = b.name.toLowerCase();
                        break;
                    case 'height':
                        valA = a.height;
                        valB = b.height;
                        break;
                    case 'weight':
                        valA = a.weight;
                        valB = b.weight;
                        break;
                    case 'id':
                    default:
                        valA = a.id;
                        valB = b.id;
                        break;
                }

                if (valA < valB) return currentSortOrder === 'asc' ? -1 : 1;
                if (valA > valB) return currentSortOrder === 'asc' ? 1 : -1;
                return 0;
            });

            renderPokemons(filtered);
        }

        searchInput.addEventListener('input', () => {
            currentSearchTerm = searchInput.value.toLowerCase().trim();
            applyFiltersAndRender();
        });

        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            currentSearchTerm = searchInput.value.toLowerCase().trim();
            applyFiltersAndRender();
        });

        clearFiltersBtn.addEventListener('click', () => {
            searchInput.value = '';
            currentSearchTerm = '';
            currentGenerationFilter = 'all';
            currentTypeFilter = 'all';
            currentSecondaryTypeFilter = 'all';
            currentFormFilter = 'all';
            currentSortBy = 'id';
            currentSortOrder = 'asc';

            localStorage.removeItem('generationFilter');
            localStorage.removeItem('typeFilter');
            localStorage.removeItem('secondaryTypeFilter');
            localStorage.removeItem('formFilter');

            document.getElementById('navbarDropdownGen').textContent = 'Generation';
            document.getElementById('navbarDropdownType').textContent = 'Type';
            document.getElementById('navbarDropdownSecondaryType').textContent = 'Secondary Type';
            document.getElementById('navbarDropdownForms').textContent = 'Forms';
            document.getElementById('navbarDropdownSort').textContent = 'Sort By: ID (Asc)';

            updateActiveNavLink(document.getElementById('home-filter'));
            updateActiveNavLink(document.querySelector(`#generation-filter-menu [data-gen-id="all"]`));
            updateActiveNavLink(document.querySelector(`#type-filter-menu [data-type="all"]`));
            updateActiveNavLink(document.querySelector(`#secondary-type-filter-menu [data-secondary-type="all"]`));
            updateActiveNavLink(document.querySelector(`#forms-filter-menu [data-form-type="all"]`));
            updateActiveNavLink(document.querySelector(`#sort-filter-menu [data-sort-by="id"][data-sort-order="asc"]`));

            applyFiltersAndRender();
        });

        // "Feeling Lucky?" button listener
        randomPokemonBtn.addEventListener('click', () => {
            if (allPokemonsData.length > 0) {
                document.querySelectorAll('.flip-card-container.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });
                document.querySelectorAll('.regional-pair-wrapper.highlight').forEach(pair => {
                    pair.classList.remove('highlight');
                });

                // Get all individual cards and pair wrappers that are visible (not d-none)
                let visibleElements = Array.from(pokemonGrid.querySelectorAll('.flip-card-container')).filter(el => el.offsetParent !== null);
                let visiblePairWrappers = Array.from(pokemonGrid.querySelectorAll('.regional-pair-wrapper')).filter(el => el.offsetParent !== null);
                
                // Combine them for random selection
                let allSelectableElements = [...visibleElements, ...visiblePairWrappers];


                if (allSelectableElements.length > 0) {
                    const randomIndex = Math.floor(Math.random() * allSelectableElements.length);
                    const randomElement = allSelectableElements[randomIndex];
                    
                    randomElement.classList.add('highlight');

                    randomElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    setTimeout(() => {
                        randomElement.classList.remove('highlight');
                    }, 3000);

                } else {
                    alert('No Pokémon are currently visible to pick a random one.');
                }
            } else {
                alert('Still loading Pokémon data. Please try again in a moment!');
            }
        });

        homeFilterLink.addEventListener('click', (e) => {
            e.preventDefault();
            searchInput.value = '';
            currentSearchTerm = '';
            currentGenerationFilter = 'all';
            currentTypeFilter = 'all';
            currentSecondaryTypeFilter = 'all';
            currentFormFilter = 'all';
            currentSortBy = 'id';
            currentSortOrder = 'asc';

            localStorage.removeItem('generationFilter');
            localStorage.removeItem('typeFilter');
            localStorage.removeItem('secondaryTypeFilter');
            localStorage.removeItem('formFilter');

            applyFiltersAndRender();
            updateActiveNavLink(e.target);
            document.getElementById('navbarDropdownGen').textContent = 'Generation';
            document.getElementById('navbarDropdownType').textContent = 'Type';
            document.getElementById('navbarDropdownSecondaryType').textContent = 'Secondary Type';
            document.getElementById('navbarDropdownForms').textContent = 'Forms';
            document.getElementById('navbarDropdownSort').textContent = 'Sort By: ID (Asc)';
            updateActiveNavLink(document.querySelector(`#generation-filter-menu [data-gen-id="all"]`));
            updateActiveNavLink(document.querySelector(`#type-filter-menu [data-type="all"]`));
            updateActiveNavLink(document.querySelector(`#secondary-type-filter-menu [data-secondary-type="all"]`));
            updateActiveNavLink(document.querySelector(`#forms-filter-menu [data-form-type="all"]`));
            updateActiveNavLink(document.querySelector(`#sort-filter-menu [data-sort-by="id"][data-sort-order="asc"]`));
        });

        generationFilterLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentGenerationFilter = e.target.dataset.genId;
                localStorage.setItem('generationFilter', currentGenerationFilter);
                searchInput.value = '';
                currentSearchTerm = '';
                
                applyFiltersAndRender();
                updateActiveNavLink(e.target);
                document.getElementById('navbarDropdownGen').textContent = e.target.textContent;
            });
        });

        typeFilterLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentTypeFilter = e.target.dataset.type;
                localStorage.setItem('typeFilter', currentTypeFilter);
                searchInput.value = '';
                currentSearchTerm = '';

                applyFiltersAndRender();
                updateActiveNavLink(e.target);
                document.getElementById('navbarDropdownType').textContent = e.target.textContent;
            });
        });

        // Secondary Type Filter Event Listener
        secondaryTypeFilterLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentSecondaryTypeFilter = e.target.dataset.secondaryType;
                localStorage.setItem('secondaryTypeFilter', currentSecondaryTypeFilter);
                searchInput.value = '';
                currentSearchTerm = '';

                applyFiltersAndRender();
                updateActiveNavLink(e.target);
                document.getElementById('navbarDropdownSecondaryType').textContent = `Secondary Type: ${e.target.textContent}`;
            });
        });

        // Forms Filter Event Listener
        formsFilterLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentFormFilter = e.target.dataset.formType;
                localStorage.setItem('formFilter', currentFormFilter);
                searchInput.value = '';
                currentSearchTerm = '';

                applyFiltersAndRender();
                updateActiveNavLink(e.target);
                document.getElementById('navbarDropdownForms').textContent = `Forms: ${e.target.textContent}`;
            });
        });

        sortFilterLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentSortBy = e.target.dataset.sortBy;
                currentSortOrder = e.target.dataset.sortOrder;
                applyFiltersAndRender();
                updateActiveNavLink(e.target);
                document.getElementById('navbarDropdownSort').textContent = `Sort By: ${e.target.textContent}`;
            });
        });

        function updateActiveNavLink(clickedLink) {
            document.querySelectorAll('.navbar-nav .nav-link.active').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelectorAll('.dropdown-item.active-filter').forEach(item => {
                item.classList.remove('active-filter');
            });

            if (clickedLink.classList.contains('dropdown-item')) {
                const parentDropdownToggle = clickedLink.closest('.dropdown').querySelector('.dropdown-toggle');
                if (parentDropdownToggle) {
                    parentDropdownToggle.classList.add('active');
                }
                clickedLink.classList.add('active-filter');
            } else {
                clickedLink.classList.add('active');
            }
        }

        async function populateCardBackDetails(pokemonId, targetElement) {
            targetElement.innerHTML = `
                <div class="text-center w-100 h-100 d-flex flex-column justify-content-center align-items-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading details...</span>
                    </div>
                </div>
            `;

            try {
                const pokemon = allPokemonsData.find(p => p.id == pokemonId);

                if (!pokemon) {
                    targetElement.innerHTML = '<p class="text-danger">Details not found.</p>';
                    return;
                }

                const typeBadges = pokemon.types.map(typeInfo => {
                    const typeName = typeInfo.type.name;
                    return `<span class="badge bg-${typeName} me-1">${typeName.charAt(0).toUpperCase() + typeName.slice(1)}</span>`;
                }).join('');

                // Calculate Base Stat Total
                let baseStatTotal = 0;
                const statsHtml = pokemon.stats.map(statInfo => {
                    baseStatTotal += statInfo.base_stat; // Add to total
                    const statName = statInfo.stat.name.replace('special-attack', 'Sp. Atk').replace('special-defense', 'Sp. Def').replace('-', ' ');
                    return `<p class="mb-1"><strong>${statName.charAt(0).toUpperCase() + statName.slice(1)}:</strong> ${statInfo.base_stat}</p>`;
                }).join('');

                let flavorText = "No description available.";
                try {
                    const speciesResponse = await axios.get(pokemon.species.url);
                    const englishFlavorTextEntry = speciesResponse.data.flavor_text_entries.find(entry => 
                        entry.language.name === 'en' && ['scarlet', 'violet', 'legends-arceus', 'sword', 'shield', 'sun', 'moon'].includes(entry.version.name)
                    ) || speciesResponse.data.flavor_text_entries.find(entry => entry.language.name === 'en');
                    
                    if (englishFlavorTextEntry) {
                        flavorText = englishFlavorTextEntry.flavor_text.replace(/[\n\f]/g, ' ');
                    }
                } catch (speciesError) {
                    console.warn("Could not fetch species data for flavor text:", speciesError);
                }

                const shinySpriteHtml = pokemon.sprites.front_shiny ?
                    `<img src="${pokemon.sprites.front_shiny}" alt="Shiny ${pokemon.name}" class="detail-img-small ms-2">` : '';

                // Original Counterpart HTML is removed from here as it's handled side-by-side in renderPokemons

                targetElement.innerHTML = `
                    <div class="back-content-wrapper">
                        <div class="text-center mb-2">
                            <img src="${getPokemonImageUrl(pokemon)}" alt="${pokemon.name}" class="detail-img-small">
                            ${shinySpriteHtml}
                            <h5 class="card-title mt-2">${pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1)} (#${pokemon.id})</h5>
                        </div>
                        <p><strong>Height:</strong> ${pokemon.height / 10} m</p>
                        <p><strong>Weight:</strong> ${pokemon.weight / 10} kg</p>
                        <p><strong>Types:</strong> ${typeBadges}</p>
                        <hr>
                        <h6>Base Stats:</h6>
                        <p class="mb-1"><strong>Total:</strong> ${baseStatTotal}</p>
                        ${statsHtml}
                        <hr>
                        <h6>Abilities:</h6>
                        <ul>
                            ${pokemon.abilities.map(abilityInfo => `<li>${abilityInfo.ability.name.charAt(0).toUpperCase() + abilityInfo.ability.name.replace('-', ' ').slice(1)}</li>`).join('')}
                        </ul>
                        <hr>
                        <h6>Description:</h6>
                        <p>${flavorText}</p>
                    </div>
                `;
            } catch (error) {
                console.error("Error populating card back details:", error);
                targetElement.innerHTML = '<p class="text-danger">Failed to load details.</p>';
            }
        }
    </script>
</body>
</html>








